# GitLab Webhook Manager

## üìò –û–ø–∏—Å–∞–Ω–∏–µ

**GitLab Webhook Manager** ‚Äî —ç—Ç–æ –ª—ë–≥–∫–∏–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Go, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ –æ—Ç GitLab –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ pipeline –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π bash-—Å–∫—Ä–∏–ø—Ç –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `scripts/`.

–°–µ—Ä–≤–∏—Å —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram ‚Äî –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

üì¶ –¢–µ–ø–µ—Ä—å –∏–º—è bash-—Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ —Å—Ö–µ–º–µ:
**<project.name>-<project.id>.sh**
(–Ω–∞–ø—Ä–∏–º–µ—Ä: `frontend-53.sh`), –≥–¥–µ `53` ‚Äî —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è `project.id` –∏–∑ GitLab webhook.

–í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram –¥–æ–±–∞–≤–ª–µ–Ω—ã:
- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ (project.id);
- –Ω–æ–º–µ—Ä pipeline;
- –≤–µ—Ç–∫–∞ (ref);
- –∫–æ–º–º–∏—Ç (—Å—Å—ã–ª–∫–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ);
- –∞–≤—Ç–æ—Ä –∫–æ–º–º–∏—Ç–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏–π pipeline;
- —Å—Å—ã–ª–∫–∏ –Ω–∞ commit –∏ pipeline –≤ GitLab.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ –æ—Ç GitLab (pipeline success);
- –í—ã–ø–æ–ª–Ω—è–µ—Ç bash-—Å–∫—Ä–∏–ø—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ö–µ–º–µ `<project.name>-<project.id>.sh`;
  (–Ω–∞–ø—Ä–∏–º–µ—Ä: `frontend-53.sh`);
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ Telegram-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞;
- –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è;
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (/reload);
- –ó–∞—â–∏—Ç–∞ –≤–µ–±—Ö—É–∫–æ–≤ —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω (X-Gitlab-Token);
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–∏–±–∫–∏—Ö –ø—É—Ç–µ–π (CONFIG_PATH, SCRIPTS_DIR);
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω (Docker + Compose);
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Telegram
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç healthcheck-—ç–Ω–¥–ø–æ–∏–Ω—Ç `/healthz` (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 200 –∏ —Ç–µ–∫—Å—Ç `ok`);

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gitlab-webhook-manager/
‚îú‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml
‚îî‚îÄ‚îÄ scripts/
    ‚îú‚îÄ‚îÄ project-a.sh
    ‚îî‚îÄ‚îÄ project-b.sh
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª: `/app/config/config.yaml`

```yaml
# –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
port: 8080

# üîí –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
# –£–∫–∞–∂–∏—Ç–µ —Ç–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω –≤ GitLab Webhook (–≤ –ø–æ–ª–µ "Secret Token")
secret_token: "very-secret-token"

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
telegram:
  enabled: true
  token: "123456789:ABCDEF123456789abcdef"
  chat_id: "987654321"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
projects:
  project-example:
    telegram:
      enabled: true
      chat_id: "111111111" # –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Ç–∞

  project-b:
    telegram:
      enabled: false # Telegram –æ—Ç–∫–ª—é—á—ë–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
```

üß† **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫**:
1. –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ);
2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram.

---

## üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/your-org/gitlab-webhook-manager.git
cd gitlab-webhook-manager
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)

```bash
mkdir -p /srv/gitlab-webhook-manager/{config,scripts}
cp config/config.yaml /srv/gitlab-webhook-manager/config/
cp scripts/* /srv/gitlab-webhook-manager/scripts/
```

### 3. –°–æ–±–µ—Ä–∏—Ç–µ Docker-–æ–±—Ä–∞–∑

```bash
docker build -t gitlab-webhook-manager .
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Docker Compose

```bash
docker compose up -d
```

---

## üß© Docker Compose

```yaml
services:
  gitlab-webhook-manager:
    image: gitlab-webhook-manager:latest
    container_name: gitlab-webhook-manager
    restart: always

    volumes:
      - ./config:/app/config:ro
      - ./scripts:/app/scripts:ro

    ports:
      - "8080:8080"

    environment:
      CONFIG_PATH: /app/config/config.yaml
      SCRIPTS_DIR: /app/scripts
      SHOW_SECRET: true
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitLab

1. –í GitLab –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí **Settings ‚Üí Webhooks**
2. –£–∫–∞–∂–∏—Ç–µ URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

   ```
   http://<your-server>:8080/
   ```

3. –û—Ç–º–µ—Ç—å—Ç–µ –≥–∞–ª–æ—á–∫—É **‚ÄúPipeline events‚Äù**
4. –ù–∞–∂–º–∏—Ç–µ **‚ÄúAdd webhook‚Äù**
5. –£–∫–∞–∂–∏—Ç–µ –≤–∞—à **Secret Token**, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–π —Å –ø–æ–ª–µ–º `secret_token` –≤ config.yaml

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º —É—Å–ø–µ—à–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ GitLab –æ—Ç–ø—Ä–∞–≤–∏—Ç POST-–∑–∞–ø—Ä–æ—Å –≤ Runner.

‚öôÔ∏è –°–µ—Ä–≤–∏—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–º—è —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—è `project.id` –∏–∑ webhook.
–ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ GitLab –ø—Ä–∏—Å–ª–∞–ª `"name": "frontend"` –∏ `"id": 53`, —Ç–æ –±—É–¥–µ—Ç
–∑–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç `scripts/frontend-53.sh`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

–≠–º—É–ª—è—Ü–∏—è GitLab webhook:

```bash
# üß™ –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ webhook —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
curl -X POST http://localhost:8080/ \
  -H "Content-Type: application/json" \
  -H "X-Gitlab-Token: very-secret-token" \
  -d '{
    "object_kind":"pipeline",
    "object_attributes":{"status":"success","id":54,"ref":"dev","url":"https://git.rusit-po.ru/.../pipelines/54"},
    "project":{"id":53,"name":"frontend","path_with_namespace":"ballons/kriogen/frontend"},
    "commit":{"id":"85fe88f7e84637...","message":"msg","url":"https://git.rusit-po.ru/.../commit/85fe88f7","author":{"name":"Alex"}},
    "user":{"name":"Alex"}
  }
```

‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:
- –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ `scripts/frontend-53.sh` (–∏–º—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ <project.name>-<project.id>);
- –õ–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª–∏;
- Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ä—Ç–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–µ–ø–ª–æ—è.

```bash
# üÜï –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
curl -X POST http://localhost:8080/reload -H "X-Gitlab-Token: very-secret-token"
```
‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è:
Config reloaded successfully

---

## üìú –ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞

`scripts/frontend-53.sh`:

‚ö†Ô∏è –ò–º—è —Å–∫—Ä–∏–ø—Ç–∞ –¥–æ–ª–∂–Ω–æ —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—É `<project.name>-<project.id>.sh`.
–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `frontend`, –∞ –µ–≥–æ ID –≤ GitLab ‚Äî `53`,
—Ç–æ —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è `frontend-53.sh`.

```bash
#!/bin/bash
set -e
echo "[INFO] Deploying Project Example..."
sleep 1
echo "[INFO] Done!"
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞:
```bash
chmod +x scripts/*.sh
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è    | –û–ø–∏—Å–∞–Ω–∏–µ                                                 | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é     |
| ------------- | -------------------------------------------------------- | ------------------------- |
| `CONFIG_PATH` | –ü—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏                               | `/app/config/config.yaml` |
| `SCRIPTS_DIR` | –ö–∞—Ç–∞–ª–æ–≥, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–∫—Ä–∏–ø—Ç—ã                            | `/app/scripts`            |
| `SHOW_SECRET` | –ï—Å–ª–∏ `true`, –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ª–æ–≥–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `secret_token` | `false`                   |
| `PORT`        | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ)                  | `8080`                    |


---

## üß∞ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)
```bash
export CONFIG_PATH=./config/config.yaml
export SCRIPTS_DIR=./scripts
export SHOW_SECRET=true
go run main.go
```

–ö–æ–Ω—Ñ–∏–≥ –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `./config/config.yaml`.

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
```bash
go fmt ./...
go vet ./...
```

---

## üì¶ –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
```bash
go build -o gitlab-webhook-manager main.go
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã (/ –∏ /reload) –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É X-Gitlab-Token.
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401 Unauthorized.
- –ó–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Å–∫—Ä—ã—Ç–æ –≤ –ª–æ–≥–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–∏ SHOW_SECRET=true.
- –°–µ—Ä–≤–∏—Å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ IP (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ GitLab).

---

## üßæ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
–ê–≤—Ç–æ—Ä: Yaroslav Tsuprak (@netvirus)
¬© 2025

---

## ‚ù§Ô∏è –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç –≤–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω –∏–¥–µ–µ–π –ø—Ä–æ—Å—Ç–æ–≥–æ DevOps-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä–∞:
‚Äú–£—Å–ø–µ—à–Ω—ã–π pipeline ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ‚Äù.
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π, CI/CD-—Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ –ª—ë–≥–∫–∏—Ö –¥–µ–ø–ª–æ–µ–≤ –±–µ–∑ —Ç—è–∂—ë–ª—ã—Ö GitLab Runner‚Äô–æ–≤.
